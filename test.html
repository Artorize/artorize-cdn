<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Artorize SAC Test - Mask Overlay Demo</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: system-ui, -apple-system, sans-serif;
      background: #1a1a1a;
      color: #fff;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }

    .description {
      text-align: center;
      color: #aaa;
      margin-bottom: 2rem;
    }

    .demo-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .viewer-box {
      background: #2a2a2a;
      border-radius: 8px;
      padding: 1.5rem;
    }

    .viewer-box h2 {
      margin-top: 0;
      font-size: 1.2rem;
      color: #4a9eff;
    }

    .canvas-stack {
      position: relative;
      display: inline-block;
      width: 100%;
      background: #000;
      border-radius: 4px;
      overflow: hidden;
    }

    .canvas-stack canvas {
      display: block;
      width: 100%;
      height: auto;
    }

    #polluted-canvas {
      position: relative;
    }

    #mask-canvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }

    .controls {
      margin-top: 1rem;
      padding: 1rem;
      background: #1a1a1a;
      border-radius: 4px;
    }

    .controls label {
      display: block;
      margin-bottom: 0.5rem;
      color: #aaa;
    }

    .controls input[type="range"] {
      width: 100%;
    }

    .controls input[type="file"] {
      width: 100%;
      padding: 0.5rem;
      background: #2a2a2a;
      border: 1px solid #444;
      border-radius: 4px;
      color: #fff;
    }

    .controls button {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.5rem;
      background: #4a9eff;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .controls button:hover {
      background: #3a8eef;
    }

    .info {
      grid-column: 1 / -1;
      padding: 1.5rem;
      background: #2a2a2a;
      border-radius: 8px;
    }

    .info h2 {
      margin-top: 0;
      color: #4a9eff;
    }

    .info code {
      background: #1a1a1a;
      padding: 2px 6px;
      border-radius: 3px;
      color: #4a9eff;
    }

    .status {
      margin-top: 1rem;
      padding: 0.75rem;
      background: #1a1a1a;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.9rem;
      color: #8f8;
    }

    .status.error {
      color: #f88;
    }

    @media (max-width: 900px) {
      .demo-section {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Artorize SAC Protocol Test</h1>
    <p class="description">Test the mask transmission and overlay system with sample or custom files</p>

    <div class="demo-section">
      <div class="viewer-box">
        <h2>Polluted Image + Mask Overlay</h2>
        <div class="canvas-stack">
          <canvas id="polluted-canvas"></canvas>
          <canvas id="mask-canvas"></canvas>
        </div>
        <div class="controls">
          <label>Mask Opacity: <span id="opacity-value">100%</span></label>
          <input type="range" id="opacity-slider" min="0" max="100" value="100">

          <label>Mask Color Mode:</label>
          <select id="color-mode" style="width: 100%; padding: 0.5rem; background: #2a2a2a; border: 1px solid #444; border-radius: 4px; color: #fff;">
            <option value="white">White Overlay</option>
            <option value="red">Red Heatmap</option>
            <option value="green">Green Heatmap</option>
            <option value="blue">Blue Heatmap</option>
            <option value="rainbow">Rainbow (by magnitude)</option>
          </select>
        </div>
      </div>

      <div class="viewer-box">
        <h2>Load Custom Files</h2>
        <div class="controls">
          <label>Polluted Image (PNG/JPG):</label>
          <input type="file" id="image-upload" accept="image/*">

          <label>SAC Mask File (.sac):</label>
          <input type="file" id="sac-upload" accept=".sac,application/octet-stream">

          <button id="load-sample-btn">Load Sample Test Data</button>
        </div>
        <div id="status" class="status">Ready to load files...</div>
      </div>

      <div class="info">
        <h2>How This Test Works</h2>
        <p>This test demonstrates the SAC v1 mask transmission protocol:</p>
        <ol>
          <li>A <strong>polluted image</strong> (the degraded version shown to AI scrapers) is loaded onto the base canvas</li>
          <li>The <strong>SAC mask file</strong> contains two int16 arrays (A and B) representing the protection mask</li>
          <li>The mask is parsed and rendered on a separate canvas <strong>stacked on top</strong> of the polluted image</li>
          <li>The stacked canvases use CSS absolute positioning to overlay the mask perfectly</li>
        </ol>

        <h3>Test Options</h3>
        <ul>
          <li><strong>Load Sample:</strong> Generates a procedural test pattern and synthetic mask data</li>
          <li><strong>Upload Custom:</strong> Test with your own polluted image and <code>.sac</code> file</li>
          <li><strong>Adjust Opacity:</strong> Control mask visibility (100% = full mask effect)</li>
          <li><strong>Color Modes:</strong> Visualize mask magnitude in different ways</li>
        </ul>

        <h3>Expected SAC File Structure</h3>
        <p>Your <code>.sac</code> file should contain:</p>
        <ul>
          <li>24-byte header with magic "SAC1", dtype=1 (int16), arrays_count=2</li>
          <li>Array A: int16 values (typically X-component of mask vector)</li>
          <li>Array B: int16 values (typically Y-component of mask vector)</li>
          <li>Both arrays must have length = width Ã— height of the image</li>
        </ul>
      </div>
    </div>
  </div>

  <script src="dist/test.js"></script>
</body>
</html>
